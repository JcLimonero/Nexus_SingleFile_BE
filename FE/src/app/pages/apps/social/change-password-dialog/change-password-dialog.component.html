<div class="change-password-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>
      <mat-icon class="mr-2 text-primary-600">lock</mat-icon>
      Cambiar Contraseña
    </h2>
    <p>Actualiza tu contraseña para mantener tu cuenta segura</p>
  </div>

  <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
    <div class="form-fields">
      <!-- Contraseña Actual -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Contraseña Actual</mat-label>
        <input 
          matInput 
          [type]="hideCurrentPassword ? 'password' : 'text'"
          formControlName="currentPassword"
          placeholder="Ingresa tu contraseña actual"
          autocomplete="current-password">
        <button 
          mat-icon-button 
          matSuffix 
          (click)="hideCurrentPassword = !hideCurrentPassword" 
          type="button"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideCurrentPassword">
          <mat-icon>{{hideCurrentPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('currentPassword')?.hasError('required')">
          {{ getErrorMessage('currentPassword') }}
        </mat-error>
      </mat-form-field>

      <!-- Nueva Contraseña -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Nueva Contraseña</mat-label>
        <input 
          matInput 
          [type]="hideNewPassword ? 'password' : 'text'"
          formControlName="newPassword"
          placeholder="Ingresa tu nueva contraseña"
          autocomplete="new-password">
        <button 
          mat-icon-button 
          matSuffix 
          (click)="hideNewPassword = !hideNewPassword" 
          type="button"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideNewPassword">
          <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-hint>Mínimo 8 caracteres</mat-hint>
        <mat-error *ngIf="changePasswordForm.get('newPassword')?.hasError('required') || changePasswordForm.get('newPassword')?.hasError('minlength')">
          {{ getErrorMessage('newPassword') }}
        </mat-error>
      </mat-form-field>

      <!-- Confirmar Nueva Contraseña -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Confirmar Nueva Contraseña</mat-label>
        <input 
          matInput 
          [type]="hideConfirmPassword ? 'password' : 'text'"
          formControlName="confirmPassword"
          placeholder="Confirma tu nueva contraseña"
          autocomplete="new-password">
        <button 
          mat-icon-button 
          matSuffix 
          (click)="hideConfirmPassword = !hideConfirmPassword" 
          type="button"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideConfirmPassword">
          <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('confirmPassword')?.hasError('required') || changePasswordForm.get('confirmPassword')?.hasError('passwordMismatch')">
          {{ getErrorMessage('confirmPassword') }}
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Botones de Acción -->
    <div class="actions-buttons flex justify-end gap-3">
      <button 
        type="button"
        mat-stroked-button 
        (click)="onCancel()"
        [disabled]="loading">
        Cancelar
      </button>
      
      <button 
        type="submit"
        mat-raised-button 
        color="primary"
        [disabled]="changePasswordForm.invalid || loading">
        <mat-spinner *ngIf="loading" diameter="20" class="mr-2"></mat-spinner>
        <mat-icon *ngIf="!loading" class="mr-2">save</mat-icon>
        {{ loading ? 'Actualizando...' : 'Actualizar Contraseña' }}
      </button>
    </div>
  </form>
</div>
