<div class="widget-distribution-metrics">
  <div class="card h-full">
    <div class="flex-none border-b py-2 px-6 flex items-center">
      <h2 class="m-0 title flex-auto">Distribución de Expedientes</h2>
      <div class="text-sm text-gray-500">
        {{ distributionMetrics?.month }} {{ distributionMetrics?.year }}
      </div>
    </div>

    <div class="flex-1 p-4">
      <div *ngIf="loading" class="flex justify-center items-center h-24">
        <mat-spinner diameter="32"></mat-spinner>
      </div>

      <div *ngIf="error" class="text-center text-red-600 p-3">
        <mat-icon class="text-red-500 mb-1">error</mat-icon>
        <p class="text-sm">{{ error }}</p>
      </div>

      <div *ngIf="!loading && !error && distributionMetrics" class="distribution-grid">
        <!-- Total del mes -->
        <div class="total-section">
          <div class="text-2xl font-bold text-blue-600">{{ distributionMetrics.total }}</div>
          <div class="text-xs text-gray-600">Total Expedientes</div>
        </div>

        <!-- Grid de categorías -->
        <div class="categories-grid">
          <!-- Entregados -->
          <div class="category-item">
            <div class="category-header">
              <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                <mat-icon class="text-green-600 text-sm">check_circle</mat-icon>
              </div>
              <div class="category-info">
                <div class="text-sm font-medium text-gray-900">Entregados</div>
                <div class="text-xs text-gray-500">{{ distributionMetrics.entregados.total }}</div>
              </div>
              <div class="text-sm font-bold text-green-600">{{ distributionMetrics.entregados.porcentaje }}%</div>
            </div>
            <mat-progress-bar 
              mode="determinate" 
              [value]="distributionMetrics.entregados.porcentaje"
              class="progress-bar-green">
            </mat-progress-bar>
          </div>

          <!-- En Proceso -->
          <div class="category-item">
            <div class="category-header">
              <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center">
                <mat-icon class="text-blue-600 text-sm">schedule</mat-icon>
              </div>
              <div class="category-info">
                <div class="text-sm font-medium text-gray-900">Proceso</div>
                <div class="text-xs text-gray-500">{{ distributionMetrics.proceso.total }}</div>
              </div>
              <div class="text-sm font-bold text-blue-600">{{ distributionMetrics.proceso.porcentaje }}%</div>
            </div>
            <mat-progress-bar 
              mode="determinate" 
              [value]="distributionMetrics.proceso.porcentaje"
              class="progress-bar-blue">
            </mat-progress-bar>
          </div>

          <!-- Canceladas -->
          <div class="category-item">
            <div class="category-header">
              <div class="w-6 h-6 bg-red-100 rounded-full flex items-center justify-center">
                <mat-icon class="text-red-600 text-sm">cancel</mat-icon>
              </div>
              <div class="category-info">
                <div class="text-sm font-medium text-gray-900">Canceladas</div>
                <div class="text-xs text-gray-500">{{ distributionMetrics.canceladas.total }}</div>
              </div>
              <div class="text-sm font-bold text-red-600">{{ distributionMetrics.canceladas.porcentaje }}%</div>
            </div>
            <mat-progress-bar 
              mode="determinate" 
              [value]="distributionMetrics.canceladas.porcentaje"
              class="progress-bar-red">
            </mat-progress-bar>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
