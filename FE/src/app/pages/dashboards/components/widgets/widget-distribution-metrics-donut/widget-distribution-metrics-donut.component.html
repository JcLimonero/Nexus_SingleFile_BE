<div class="vex-widget-distribution-metrics-donut">
  <mat-card class="vex-card">
    <mat-card-header class="vex-card-header">
      <mat-card-title class="vex-card-title">
        <mat-icon class="vex-card-title-icon">pie_chart</mat-icon>
        <span>Distribución de Expedientes - Septiembre</span>
      </mat-card-title>
      
      <div class="vex-card-actions" *ngIf="showDetails">
        <button mat-icon-button (click)="refresh()" [disabled]="loading">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </mat-card-header>

    <mat-card-content class="vex-card-content">
      <div class="widget-content">
        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container">
          <mat-spinner diameter="40"></mat-spinner>
          <p class="loading-text">Cargando métricas de distribución...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="error && !loading" class="error-container">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <p class="error-text">{{ error }}</p>
          <button mat-button color="primary" (click)="refresh()">
            <mat-icon>refresh</mat-icon>
            Reintentar
          </button>
        </div>

        <!-- Chart Content -->
        <div *ngIf="!loading && !error" class="chart-container">
          <div *ngIf="!distributionMetrics" class="no-data-container">
            <mat-icon class="no-data-icon">pie_chart_outlined</mat-icon>
            <p class="no-data-text">No hay datos disponibles para el mes actual</p>
          </div>

          <div *ngIf="distributionMetrics" class="chart-wrapper">
            <vex-chart
              [series]="series"
              [options]="options">
            </vex-chart>
          </div>
        </div>

        <!-- Summary Stats -->
        <div *ngIf="!loading && !error && distributionMetrics" class="summary-stats">
          <div class="stat-item">
            <span class="stat-label">Total Septiembre:</span>
            <span class="stat-value">{{ totalCases }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Estados:</span>
            <span class="stat-value">{{ getStatusCount() }}</span>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
